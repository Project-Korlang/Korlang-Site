#!/usr/bin/env sh
VERSION="v0.0.1-alpha"

show_help() {
  cat <<EOH
korlang $VERSION

Usage:
  korlang new <name> [--lib|--ui|--cloud]
  korlang build <file.kor> [-o out]
  korlang run <file.kor>
  korlang test
  korlang doc

Options:
  -h, --help   Show this help
EOH
}

cmd="$1"
shift || true

case "$cmd" in
  -h|--help|help)
    show_help
    ;;
  new)
    name="$1"
    [ -z "$name" ] && { echo "korlang new <name>"; exit 1; }
    mkdir -p "$name/src"
    cat > "$name/Korlang.config" <<CFG
[package]
name = "$name"
version = "0.1.0"

[dependencies]
CFG
    cat > "$name/src/main.kor" <<SRC
fun main() -> Int {
  0
}
SRC
    echo "Created $name"
    ;;
  build)
    file="$1"
    [ -z "$file" ] && { echo "korlang build <file.kor>"; exit 1; }
    out="a.out"
    shift
    while [ $# -gt 0 ]; do
      if [ "$1" = "-o" ] && [ -n "$2" ]; then
        out="$2"; shift 2; continue
      fi
      shift
    done
    echo "(stub) Compiled $file -> $out"
    ;;
  run)
    file="$1"
    [ -z "$file" ] && { echo "korlang run <file.kor>"; exit 1; }
    echo "(stub) Running $file"
    ;;
  test)
    echo "(stub) Running tests"
    ;;
  doc)
    echo "(stub) Generating docs"
    ;;
  "")
    echo "korlang $VERSION"
    ;;
  *)
    echo "korlang $VERSION"
    ;;
esac
